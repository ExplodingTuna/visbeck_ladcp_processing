#######################################################################
# Edit this file to configure the ladcp processing program for a      #
# cruise. You can add comments by starting a line with "#" .          #
# Any line that starts with a "#" will be ignored. Don't add comments #
# after a variable because this can mess up the parsing of this file  #
# in some versions of Matlab and Octave.                              #
# Using the "%" percent symbol in comments on a line before a line    #
# with a variable to read can cause that variable to be ignored.      #
# Avoid  using "%"                                                    #
#                                                                     #
#                                                                     #
#######################################################################

#######################################################################
# to process the cast in the current directory, set this variable to  #
# "." without quotes. All the paths in the script  should be          #
# relative to this path. You can use both UNIX and Windows paths      #
#                                                                     #
working_directory=/home/user/data/ladcp_proc
#
#######################################################################
# The cruise_id_* variables are used to construct the filenames       #
# that the script will look for.                                      #
#                                                                     #
cruise_id=AB1705
cruise_id_prefix=
cruise_id_suffix=
#
#######################################################################
# The year in which the data were collected.                          #
#                                                                     #
correct_year=2017
#
#######################################################################
# When set to 1 it will use an existing mat file instead of           #
# the vis file for the navigational data.                             #
# Place the mat file in the raw_nav folder.                           #
#                                                                     #
use_mat_for_nav=0
#
#######################################################################
# Generate a navigation vis file from the 1Hz/dB processed ctd data,  # 
# a gps capture file,a POSMV file or an externally provided vis file. #    
# There are many ways to generate a nav file. For instance, you could #
# capture a GPS feed to a file that has a standard RMC string and use #
# the included "rmc2nav" program to create a navigation file.         #
# Place the rmc and posmv files in the "external_nav" folder.         #
#                                                                     #
#        "0"   -Use an externally created vis file. The program will  #
#               not attempt to generate a vis file.                   # 
#                                                                     #
#        "1"   -Use Seabird processed cnv file. This option attempts  #
#               to use the 1Hz data and then the 1db file to generate #
#               a vis file. This is the default option.               #
#                                                                     #
#        "2"   -Use a text file that contains GPRMC strings from a    #
#               GPS to generate a vis file.                           #
#               The ships tech can usually provide a GPS feed         #  
#               that can be captured to a text file. rmc2nav.m is     #
#               used to pull the date and position but the file can   #
#               only have GPRMC strings in it. Clean the file first!  #
#               If you are using linux or unix there is a bash script #
#               in the "helper_scripts" directory that can do this.   #
#               The file is named "grepRMC".                          #
#               Open the file to see a usage example.                 #
#               
#                                                                     #
#        "3"   -Use a text file that contains POSMV strings from an   #
#               Applanix model V3. posmv2nav.m is                     #
#               used to pull the date and position but the file can   #
#               only have POSMV strings in it. Clean the file first.  #
#               If you are using linux or unix there is a bash script #
#               in the "helper_scripts" directory that can do this.   #
#               The file is named "combinePosMV".                     #
#               Open the file to see a usage example.                 #
#               This was script was written using files from the FG.  #
#               Walton Smith with the assumption that POSMV files     #
#               always look like this so it may not work. Modify it   #
#               for your format.                                      #
#    
make_nav=1
#
#######################################################################
# Include sadcp data when processing. This is generally not done at   #
# sea. Set this to 1 if there is sadcp data to include.               #
#                                                                     #
use_sadcp=0
#
#######################################################################
# Sets the image format for the plots. Below are valid values.        #
#                                                                     #
# "ps"    -Full-page PostScript (PS) Level 3 black and white          #
# "ps2"   -Full-page PostScript (PS) Level 2 black and white          #
# "psc"   -Full-page PostScript (PS) Level 3 color                    #
# "psc2"  -Full-page PostScript (PS) Level 2 color                    #
# "eps"   -Encapsulated PostScript (EPS) Level 3 black and white      #
# "eps2"  -Encapsulated PostScript (EPS) Level 2 black and white      #
# "epsc"  -Encapsulated PostScript (EPS) Level 3 color                #
# "epsc2" -Encapsulated PostScript (EPS) Level 2 color                #
# "jpg"   -JPEG 24-bit                                                #
# "jpeg"  -JPEG 24-bit                                                #
# "png"   -PNG 24-bit                                                 #
# "svg"   -SVG (Scalable Vector Graphics)                             #
# "pdf"   -Full page Portable Document Format (PDF) color             #
#                                                                     #
print_formats=psc
#
#######################################################################
# Set to 1 if an error is generated similar to the one below.         #
#                                                                     #
# "Error using griddedInterpolant.The grid vectors are not strictly   #
# monotonic increasing."                                              #
#                                                                     #
remove_zctd_downcast=1
#
#######################################################################
# Set to 1 if there is no uplooker data.                              #
#                                                                     #
use_master_only=0
#                                                                     #
#######################################################################
#                                                                     #
down_up=1
enable_nav=1
enable_ctdprof=1
enable_ctdtime=1
override_sn=0
down_sn=098765
up_sn=123456
dz=10
#                                                                     #
#######################################################################
# stuff from default_params.m these are all params
# manually set POSITION of the start and end point
# [degree lat, minute lat, degree lon, minute lon]
# i.e. [-59 -30.5697 -44 -22.4986]
#                                                                     #
pose=[0 0 0 0]*nan
poss=[0 0 0 0]*nan
position_fixed=0
lat_for_calc=nan
lon_for_calc=nan
time_start=[]
time_end=[]
#######################################################################
# Restrict time range to profile and disregard data close to surface  #
# cut = 0 dont restrict                                               #
# cut > 0 restrict time to adcp depth below a depth of cut            #
#                                                                     #
cut=10
#                                                                     #
#######################################################################
# This one is later used to determine the weight of the ship          #
# movement constraint. It should be set to something like the         #
# uncertainty of the position of the CTD when it is coming on         #
# deck. I.e. the GPS error plus something accounting for the          #
# position difference between GPS antenna and CTD (remember           #
# the ship can rotate !).                                             #
# 30 m is a reasonable number.                                        #
#                                                                     #
nav_error=30
#                                                                     #
#######################################################################
# SUPER ENSEMBLES                                                     #
# are calculated in prepinv.m to reduce the number of raw profiles.   #
# The idea is to obtain one average profile for each vertical         #
# dz=const that the CTD traveled through. As a result a constant      #
# number of super ensembles are obtained for the up and down cast.    #
# but a fixed number of ensembles can also be averaged.               #
#                                                                     #
# avdz sets the depth interval between adjacent super-ensembles       #
# default one bin length                                              #
#                                                                     #
# since the bin length is profile dependent we can not set it here.   #
#                                                                     #
# if avdz is negative, -avdz bin lengths will be used for avdz.       #
# if avdz is positive, avdz will be used as is.                       #
# the calculation takes place in  calc_ens_av.m.                      #
#                                                                     #
# avens will take precedence over avdz.                               #
#                                                                     #
avdz=-1
#                                                                     #
#######################################################################
# avens overrides avdz and sets a fixed number of ensembles to        #
# average default. NAN means that it is not used.                     #
#                                                                     #
avens=NaN
#                                                                     #
#######################################################################
# BOTTOM TRACK                                                        #
# There are several options to get bottom track data                  #
#                                                                     #
#  mode = 1 :   use only RDI bottom track                             #
#         2 :   use only own bottom track                             #
#         3 :   use RDI, if existent, own else (default)              #
#         0 :   use not bottom track at all                           #
#                                                                     #
# btrk_mode is the one you set to be used, btrk_used is the           #
# the routine has used. They do not need to agree since the           #
# software can override your command, e.g. in case some               #
# necessary data is missing or all BTRK are bad.                      #
#                                                                     #
btrk_mode=3
btrk_used=0
#                                                                     #
#######################################################################
# btrk_ts is in dB to detect bottom above bin1 level (for own btm     #
# track).The following parameter (bottom-tracking target strength)    #
# is quite iffy. Setting it to too small a value (e.g. 10, the old    #
# default) makes instrument interference appear as a false bottom,    #
# which can be a problem. For example, on CLIVAR P02 station 32 there #
# was a long stop 16m above the sea bed, which is too close for       #
# bottom tracking.  True bottom detection is only possible during the #
# approach and the beginning of the upcast. These two short times are #
# swamped out by the interference-related false bottom detections.    #
# On the other hand, when this value is set to too large a value,     #
# true seabed returns are rejected. It would be fairly easy to set    #
# the correct value in terms of instrument-returned target strength   #
# by plotting the target strength with imagesc(d.wts). However, the   #
# values of this parameter are not instrument-returned target         #
# strengths but db. The current value is valid for the combo of       #
# downlooking BB150 / uplooking WH300 used on the CLIVAR P02 cruise.  # 
# It was derived by trial and error, involving stations 2 and 32.     #
#                                                                     #
btrk_ts=10
#                                                                     #
#######################################################################
# btrk_below gives binoffset used below target strength maximum       #
# to make bottom track velocity                                       #
#                                                                     #
btrk_below=0.5
#                                                                     #
#######################################################################
# maximum allowed difference between reference layer W and W bottom   #
# track.
#                                                                     #
btrk_wlim=0.08
#                                                                     #
#######################################################################
# force to recalculate bottom distance using target strength          #
# this is turned off (0) by default and is being automatically        #
# turned on (1), if the routine recognizes a large number of          #
# bad (equal 0) RDI distances to the bottom                           #
#                                                                     #
bottomdist=0
#                                                                     #
#######################################################################
# surfdist=1 use surface reflections of up looking ADCP               #
# to get start depth                                                  #
#                                                                     #
surfdist=1
#                                                                     #
#######################################################################
# MAGNETIC deviation in degrees                                       #
#                                                                     #
magdev=0
#                                                                     #
#######################################################################
# COMPASS manipulation                                                #
# experts only                                                        #
# fix_compass:1 means hdg_offset gets added                           #
# fix_compass:2 means up looker gets down compass + hdg_offset        #
# fix_compass:3 means down looker gets up compass + hdg_offset        #
#                                                                     #
fix_compass=0
#                                                                     #
#######################################################################
# In case the two instruments are running not synchronous, one        #
# is resampled onto the other. This is done by simply taking          #
# one instrument as the reference (default the downlooker) and        #
# each of its ensembles pick the closest in time of the other         #
# instrument. Depending on the ping rates and which instrument        #
# is pinging faster, this will result in whole ensembles being        #
# dropped or used multiple times.                                     #
#                                                                     #
# up2down==1 will resample the uplooker onto the downlooker           #
#                                                                     #
up2down=1
#                                                                     #
#######################################################################
# COMPASS:  rotup2down                                                #
# how to best adjust compass to best match                            #
# if 1 rotate up-looking and down-looking instrument to mean heading  #
#    2 rotate up-looking and down-looking velocities to match up      #
#      velocities (not really recommended and very likey buggy !!!)   #
#    3 rotate up-looking velocities to down heading                   #
#        (use if you suspect that the up heading is bad)              #
#    4 rotate down-looking velocities to up heading                   #
#        (use if you suspect that the down heading is bad)            #
#    5 no rotation applied to compensate for compass differences      #
#                                                                     #
rotup2down=1
#                                                                     #
#######################################################################
# Offset correction: offsetup2down                                    #
# if 1 remove velocity offset between up and down looking ADCP        #
# this will correct errors due to tilt biases etc.                    #
#                                                                     #
offsetup2down=1
#                                                                     #
#######################################################################
#     zpar                                                            #
# DEPTH of the start, bottom and end of the profile                   #
# positive downwards                                                  #
#                                                                     #
zpar=0 NaN 0
#                                                                     #
#######################################################################
# maxbinrange                                                         #
# maximum number of bins to be used                                   #
# 0 : all will get used                                               #
#                                                                     #
maxbinrange=0
#                                                                     #
#######################################################################
# set ctdmaxlag=100 to the maximum pings that the ADCP data can be    #
# shifted to best match W calculated from CTD pressure time series    #
# (loadctd) If you have good times set it to 10... if your time base  #
# is questionable you can set it 100 or more.                         #
#                                                                     #
ctdmaxlag=150
#                                                                     #
#######################################################################
#                                                                     #
ctdmaxlagnp=600
#                                                                     #
#######################################################################
# ts_save                                                             #
# save individual target strength ts_save=[1 2 3 4]                   #
#                                                                     #
ts_save = 0
#                                                                     #
#######################################################################
# cm_save                                                             #
# save individual correlation cm_save=[1 2 3 4]                       #
#                                                                     #
cm_save = 0
#                                                                     #
#######################################################################
# pg_save                                                             #
# save individual percent good pings pg_save=[1 2 3 4]                #
#                                                                     #
pg_save = 0
#                                                                     #
#######################################################################
# nav_1200                                                            #
# 1200kHz WH data is too high resolution to be merged with other data #
# it thus needs to be averaged before being used                      #
# this gives the number of values to be averaged                      #
#                                                                     #
nav_1200=4
#                                                                     #
#######################################################################
# error_limit_1200                                                    #
# a 1200kHz measures very close to the rosette                        #
# high error velocities result when measured in the eddy tail         #
# of the rosette this parameter sets the threshold of values to be    #
# discarded. 
# not used GK                                                         #
#                                                                     #
error_limit_1200=20
#                                                                     #
#######################################################################
# extra blank in meters                                               #
#                                                                     #
extra_blank_1200=5
#                                                                     #
#######################################################################
# OUTLIER detection is called twice once to clean the raw data        #
# and a second time to clean the super ensembles                      #
# [n1 n2 n3 ...] the length gives the number of scans and             #
# each value the maximum allowed departure from the mean in std       #
# applied for the u,v,w fields for each bin over blocks               #
# of p.outlier_n profiles                                             #
#                                                                     #
# 2: very strong  3: medium  4:only largest outliers                  #
#                                                                     #
outlier=1                                                             
outlier_detect=4 3
#                                                                     #
#######################################################################
# SPIKES                                                              #
#                                                                     #
# maximum value for abs(V-error) velocity                             #
elim=0.2
# maximum value for horizontal velocity                               #
vlim=2.5
# minimum value for percent -good                                     #
pglim=0.3
# maximum value for W difference between the mean W and actual        #
# W(z) for each profile.                                              # 
wlim=0.08
#                                                                     #
#######################################################################
# TILT  flag data with large tilt or tilt differences as bad          #
# [22  (max tilt allowed)                                             #
# 4 (maximum tilt difference between pings allowed)]                  #
# WH systems have reported decent profiles with up to 35 deg tilt ... #
#                                                                     #
tiltmax=30 4
#                                                                     #
#######################################################################
# TILT  reduce weight for large tilts                                 #
# calculated after an obscure formula in prepinv.m GK                 #
# have a look at                                                      #
# plot([0:0.1:30],1.-tanh([0:0.1:30]/params.tilt_weight)/2)           #
# to see the effect                                                   #
# 10 means a weight of 1.0 for tilts of  0 deg                        #
#           a weight of 0.6 for tilts of 10 deg                       #
#           a weight of 0.5 for tilts of 30 deg                       #
#                                                                     #
# a tilt_weight of 20 appears to be more gentle, GK                   #
#                                                                     #
tilt_weight=10
#                                                                     #
#######################################################################
# fix TIME of the ADCP in days                                        #
# positive numbers shift the ADCP's time to a later time              #
# (i.e. timoff is added to the julian time of the ADCP)               #
# Please note that here is only one offset possible.                  #
# This is the offset of the MASTER system.                            #
# Should the LADCP slave system have a different offset, it           #
# will be handled by the data shifting of the slave.                  #
#                                                                     #
timoff=0
#                                                                     #
#######################################################################
# fix time of uplooking ADCP relative to downlooking ADCP             #
# e.g. when the clocks were never properly set                        #
#                                                                     #
# Usually that is taken care of by the automatic shifting.            #
# But this will fail when the uplooking system apparently start       #
# before the downlooking one, but in reality starts later.            #
#                                                                     #
# In that case you can shift the uplooking data to later              #
# times by giving a positive number. Units are days.                  #
# There will be a paused control plot to compare the vertical         #
# velicities.                                                         #
#                                                                     #
timoff_uplooker=0
timoff_downlooker=0
#                                                                     #
#######################################################################
# by up to how many ensembles shall the slave be shifted              #
# against the master so that the vertical velocities match            #
# usually 20 is enough. But if the times of master and                #
# slave were not properly set a much larger number might              #
# be necessary                                                        #
#                                                                     #
maxlag=50
#                                                                     #
#######################################################################
# There is still an old slower up/down lag routine implemented        #
# it is turnned off by default and the newer one is used              #
# it will automatically turn on, if the bestlag found has a           #
# correlation of less than 0.9                                        #
#                                                                     #
bestlag_testing_on=0
#                                                                     #
#######################################################################
# I found a case where we had nearly only 3 beam solutions. This      #
# prevented the lag determination routine from finding the correct    #
# lag. Here one can force the routine to also use 3 beam data.        #
#                                                                     #
use_3beam_w_for_lag=0
#                                                                     #
#######################################################################
# In case the instruments do not ping in sync but the ping rates      #
# differ only by a tiny amount the routine will not automatically     #
# resample the uplooker onto the downlooker timing. This can be       #
# forced by setting the following parameter to 1.                     #
#                                                                     #
force_resample_uplooker=0
#                                                                     #
#######################################################################
# Apply tilt correction.                                              #
# tiltcor(1)=down-pitch bias                                          #
# tiltcor(2)=down-rol bias                                            #
# tiltcor(3)=up-pitch bias                                            #
# tiltcor(4)=up-rol bias                                              #
#                                                                     #
tiltcor=0
#                                                                     #
#######################################################################
# Give bin number for the best W to compute depth of the ADCP         #
# default uses bin 2-3 but be careful when up/down instruments        #
# are used. The good bins are in the middle!                          #
#                                                                     #
trusted_i=2:5
#                                                                     #
#######################################################################
# SET ambiguity velocity used [m/s]                                   #
# not used for anything, but stored in the archival data !? GK        #
#                                                                     #
ambiguity=2.5
#                                                                     #
#######################################################################
# clear LADCPs pressure sensor
# sometimes has strange data and w integration might be preferred
#
# 1 clears the pressure records
#                                                                     #
clear_ladcp_pressure=0
weight_ladcp_pressure=0.1
#                                                                     #
#######################################################################
# Write matlab file                                                   #
#                                                                     #
savemat=0
#                                                                     #
#######################################################################
# Write netcdf file                                                   #
#                                                                     #
savecdf=1
#                                                                     #
#######################################################################
# Save Plots                                                          #
# Save figure numbers to ps file                                      #
#     1 : Summary Plot                                                #
#     2 : Engineering Data                                            #
#     3 : Data Quality                                                #
#     4 : Depth                                                       #
#     5 : Heading Corrections                                         #
#     6 : Up/Down Differences                                         #
#     7 : CTD Position                                                #
#     8 : Shear                                                       #
#     9 : SADCP U, V                                                  #
#    10 : U, V Offsets, Tilt Error                                    #
#    11 : Processing Warnings                                         #
#    12 : Inversion Constraints                                       #
#    13 : Bottom Track detail                                         #
#    14 : Target Strength                                             #
#    15 : Correlation                                                 #
#    16 : Weights                                                     #
#                                                                     #
saveplot=1:16
#                                                                     #
#######################################################################
#                                                                     #
shear=1
#                                                                     #
#######################################################################
#                                                                     #
std_weight=1
#                                                                     #
#######################################################################
#                                                                     #
barofac=1
#                                                                     #
#######################################################################
#                                                                     #
botfac=5
#                                                                     #
#######################################################################
#                                                                     #
smoofac=0
#                                                                     #
#######################################################################
#                                                                     #
smallfac=1 0
#                                                                     #
#######################################################################
#                                                                     #
sadcpfac=5
#                                                                     #
#######################################################################
#                                                                     #
sadcp_dtok=0
#                                                                     #
#######################################################################
#                                                                     #
shear_weightmin=0.1
#                                                                     #
#######################################################################
#                                                                     #
up_dn_looker=1
#                                                                     #
#######################################################################
#                                                                     #
solve=1
#                                                                     #
#######################################################################
#                                                                     #
weightmin=0.05
#                                                                     #
#######################################################################
#                                                                     #
weightpower=1
#                                                                     #                                                                   #
#######################################################################
#                                                                     #
dragfac=0
#                                                                     #
#######################################################################
#                                                                     #
drag_tilt_vel=0.5
#                                                                     #
#######################################################################
#                                                                     #
drag_lag_tim=20
#                                                                     #
#######################################################################
#                                                                     #
drag_lag_depth=2000
#                                                                     #
#######################################################################
#                                                                     #
plot_range=nan nan nan 0
#                                                                     #
#######################################################################
#                                                                     #
btrk_plot_range=400
#                                                                     #
#######################################################################
#                                                                     #
edit_mask_dn_bins=[1]
#                                                                     #
#######################################################################
#                                                                     #
edit_mask_up_bins=[1]
#                                                                     #
#######################################################################
#                                                                     #
edit_hardremove_mask_dn_bins=[]
#                                                                     #
#######################################################################
#                                                                     #
edit_hardremove_mask_up_bins=[]
#                                                                     #
#######################################################################
#                                                                     #
edit_sidelobes=1
#                                                                     #
#######################################################################
#                                                                     #
edit_spike_filter_max_curv=0.1
#                                                                     #
#######################################################################
#                                                                     #
edit_PPI=0
#                                                                     #
#######################################################################
#                                                                     #
edit_PPI_layer_thickness=180
#                                                                     #
#######################################################################
#                                                                     #
edit_PPI_max_hab=1000
#                                                                     #
#######################################################################
#                                                                     #
edit_skip_ensembles=[]
#                                                                     #
#######################################################################
#                                                                     #
detect_asynchronous=0
#                                                                     #
#######################################################################
#                                                                     #
zbottom=0
#                                                                     #
#######################################################################
#                                                                     #
zbottomerror=0
#                                                                     #
#######################################################################
#                                                                     #
edit_mask_last_bin=0
#                                                                     #
#######################################################################
#                                                                     #
warn=LADCP WARNINGS
#                                                                     #
#######################################################################
#                                                                     #
messages_warnp=LADCP processing warnings:
#                                                                     #
#######################################################################
#                                                                     #
ladcp_cast=1
#                                                                     #
#######################################################################
#                                                                     #
warnp=[]
#                                                                     #
#######################################################################
#                                                                     #
dist_up_down=0
#                                                                     #
#######################################################################
#                                                                     #
minimum_correlation_threshold=[0,0]
#                                                                     #
#######################################################################
#                                                                     #
down_up_weight_factors=[1,1]
#                                                                     #
#######################################################################
#                                                                     #
remove_first_pings_of_uplooker=0
#                                                                     #
#######################################################################
#                                                                     #
set_lag_up2down=nan
#                                                                     #
#######################################################################
#                                                                     #
set_hdg_offset=nan
#                                                                     #
#######################################################################
#                                                                     #
down_deviation_table=[]
#                                                                     #
#######################################################################
#                                                                     #
beam2earth_allow_3beam_solutions=1
#                                                                     #
#######################################################################
#                                                                     #
beam2earth_bad_up_beam=nan
#                                                                     #
#######################################################################
#                                                                     #
beam2earth_bad_down_beam=nan
#                                                                     #
#######################################################################

